<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Livre</title>
        <link rel="stylesheet" href="./lib/font-awesome-4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="style.css">
        <script type="text/javascript" src="./node_modules/epub.js/build/epub.min.js"></script>
        <script type="text/javascript" src="./node_modules/epub.js/build/libs/zip.min.js"></script>
    </head>
    <body>
        <div id="app">
            <i id="page-left" class="fa fa-chevron-left arrow" onclick="Book.prevPage();"></i>
            <div id="book">
                <h1 class="no-book-message" onclick="loadBookDialog();">Open a book (Ctrl-O)...</h1>
            </div>
            <i id="page-right" class="fa fa-chevron-right arrow" onclick="Book.nextPage();"></i>
        </div>
        <script>
         const {ipcRenderer, remote} = require('electron');
         const {dialog} = remote;
         const DEFAULT_FONT_SIZE = 18;

         const loadBook = function(bookPath) {
             const $book = document.getElementById('book');
             $book.innerHTML = "";
             Book.open(bookPath);
             Book.renderTo($book);
         }

         const win = remote.getCurrentWindow();
         document.body.style.height = win.getSize()[1] - 20 + "px";
         win.on('resize', () => {
             document.body.style.height = win.getSize()[1] - 20 + "px";
         });

         const openDialogOptions = {
             filters: [
                 {name: "eBooks", extensions: ['epub']}
             ],
             properties: ['openFile']
         };
         
         const loadBookDialog = function() {
             dialog.showOpenDialog(win, openDialogOptions, (bookPaths) => {
                 if (bookPaths) {
                     loadBook(bookPaths[0]);
                 }
             });
         }
         
         let currentFontSize = DEFAULT_FONT_SIZE;
         
         const Book = ePub({
             restore: true,
             styles: {
                 "font-size": DEFAULT_FONT_SIZE + "px"
             }
         });

         ipcRenderer.on('loadBook', (event, bookPath) => {
             loadBook(bookPath);
         });

         ipcRenderer.on('prevPage', () => {
             Book.prevPage();
         });

         ipcRenderer.on('nextPage', () => {
             Book.nextPage();
         });

         ipcRenderer.on('increaseFont', () => {
             currentFontSize += 2;
             Book.setStyle("font-size", currentFontSize + "px");
         });

         ipcRenderer.on('decreaseFont', () => {
             currentFontSize -= 2;
             Book.setStyle("font-size", currentFontSize + "px");
         });

         ipcRenderer.on('restoreFont', () => {
             currentFontSize = DEFAULT_FONT_SIZE;
             Book.setStyle("font-size", currentFontSize + "px");
         });
        </script>
    </body>
</html>
